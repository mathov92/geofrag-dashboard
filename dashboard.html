<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo√∏konomisk Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Garamond', 'Georgia', serif;
            background: #DEDEDE;
            min-height: 100vh;
            padding: 20px;
        }
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #5A1C26;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.8em;
            font-weight: normal;
            letter-spacing: 0.02em;
        }
        .status-bar {
            background: #EE3A36;
            border-radius: 4px;
            padding: 12px 24px;
            margin-bottom: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status { 
            font-size: 0.95em;
            letter-spacing: 0.01em;
        }
        .live-indicator {
            width: 10px;
            height: 10px;
            background: #6A8F7F;
            border-radius: 50%;
            animation: pulse 2s infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .print-button {
            background: white;
            color: #5A1C26;
            border: 2px solid white;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.9em;
            cursor: pointer;
            font-family: 'Garamond', 'Georgia', serif;
            transition: all 0.3s ease;
        }
        
        .print-button:hover {
            background: #5A1C26;
            color: white;
            transform: translateY(-1px);
        }
        .wide-card {
            background: white;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(77, 77, 77, 0.15);
            transition: transform 0.3s ease;
            border: 1px solid #E8E8E8;
            margin-bottom: 20px;
            position: relative;
            max-height: 480px;
        }
        .wide-card:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 77, 77, 0.2);
        }
        .wide-card h2 {
            color: #5A1C26;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: normal;
            letter-spacing: 0.01em;
        }
        
        /* Country selector dropdown styles */
        .country-selector {
            position: relative;
            display: inline-block;
            float: right;
            margin-top: -10px;
        }
        
        .dropdown-button {
            background: white;
            border: 1px solid #2A6965;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.85em;
            cursor: pointer;
            font-family: 'Garamond', 'Georgia', serif;
            color: #2A6965;
            min-width: 150px;
            text-align: left;
            position: relative;
            padding-right: 25px;
        }
        
        .dropdown-button:after {
            content: '‚ñº';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7em;
        }
        
        .dropdown-button:hover {
            background: #F5F5F5;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 1px solid #E8E8E8;
            border-radius: 4px;
            z-index: 100;
            right: 0;
            margin-top: 2px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #F5F5F5;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: #F5F5F5;
        }
        
        .dropdown-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .dropdown-item label {
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .country-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-left: auto;
            border: 1px solid #E8E8E8;
        }
        
        .wide-card .chart-wrapper {
            height: 240px;
            position: relative;
            margin-bottom: 10px;
            padding-top: 10px;
        }
        .wide-card canvas {
            max-height: 240px !important;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(77, 77, 77, 0.15);
            transition: transform 0.3s ease;
            border: 1px solid #E8E8E8;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .card:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 77, 77, 0.2);
        }
        .card h2 {
            color: #5A1C26;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: normal;
            letter-spacing: 0.01em;
        }
        .card .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 240px;
            max-height: 280px;
            margin-bottom: 10px;
        }
        .card canvas {
            max-height: 280px !important;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 10px;
            background: #F5F5F5;
            border-radius: 4px;
            border: 1px solid #E8E8E8;
            font-size: 0.9em;
        }
        .metric-value {
            font-size: 1.05em;
            font-weight: bold;
            color: #2A6965;
        }
        .trend {
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.7em;
            font-weight: bold;
        }
        .trend.up { background: #FFEBE9; color: #EE3A36; }
        .trend.down { background: #E8F4F0; color: #2A6965; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #4D4D4D;
        }
        .citation {
            font-size: 0.75em;
            color: #6D6D6D;
            font-style: italic;
            margin-top: 10px;
            line-height: 1.4;
            letter-spacing: 0.01em;
        }
        
        /* Metrics grid for wide card */
        .wide-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 5px;
            padding-top: 5px;
        }
        
        .wide-metrics-grid .metric {
            margin: 0;
            padding: 8px;
            font-size: 0.85em;
        }
        
        .wide-metrics-grid .metric-value {
            font-size: 1em;
        }
        
        /* Dual Range Slider Styles */
        .slider-container {
            margin: 10px auto 10px;
            width: 85%;
            max-width: 400px;
            padding: 0;
        }
        
        .wide-card .slider-container {
            margin: 5px auto 5px;
            max-width: 450px;
        }
        
        .slider-wrapper {
            position: relative;
            height: 25px;
            margin: 10px 0 5px 0;
        }
        
        .slider-track {
            position: absolute;
            width: 100%;
            height: 4px;
            background: #E8E8E8;
            border-radius: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .slider-range {
            position: absolute;
            height: 4px;
            background: #2A6965;
            border-radius: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .slider-left, .slider-right {
            position: absolute;
            width: 100%;
            height: 4px;
            background: transparent;
            pointer-events: none;
            top: 50%;
            transform: translateY(-50%);
            -webkit-appearance: none;
        }
        
        .slider-left::-webkit-slider-thumb,
        .slider-right::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #2A6965;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            position: relative;
            z-index: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-left::-moz-range-thumb,
        .slider-right::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #2A6965;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            position: relative;
            z-index: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.7em;
            color: #5A1C26;
        }
        
        .slider-value-display {
            text-align: center;
            margin-top: 2px;
            font-size: 0.8em;
            color: #2A6965;
            font-weight: 500;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
                font-size: 11pt;
            }
            
            .dashboard {
                max-width: 100%;
                padding: 10mm 15mm;
            }
            
            h1 {
                font-size: 18pt;
                margin-bottom: 10px;
                page-break-after: avoid;
                text-align: center;
            }
            
            .status-bar {
                display: none;
            }
            
            .print-button {
                display: none;
            }
            
            /* Wide card for trade openness - single column */
            .wide-card {
                page-break-inside: avoid;
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #999;
                margin-bottom: 15px;
                padding: 10px;
                max-height: none;
                width: 100%;
            }
            
            .wide-card h2 {
                font-size: 11pt;
                margin-bottom: 8px;
            }
            
            /* Trade chart wrapper and canvas */
            .wide-card .chart-wrapper {
                height: 140px !important;
                max-height: 140px !important;
                width: 100% !important;
                padding-top: 0;
                margin-bottom: 8px;
                position: relative;
            }
            
            .wide-card canvas {
                max-height: 140px !important;
                height: 140px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* Grid layout - SINGLE COLUMN for print */
            .grid {
                display: block !important;
                page-break-before: avoid;
            }
            
            /* Individual cards - one per row */
            .card {
                page-break-inside: avoid;
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #999;
                padding: 10px;
                margin-bottom: 15px;
                display: block !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* Special page break rules */
            .card:nth-child(1) {
                page-break-before: avoid;
            }
            
            .card:nth-child(2) {
                page-break-before: always;
            }
            
            .card:nth-child(3) {
                page-break-before: avoid;
            }
            
            .card:nth-child(4) {
                page-break-before: always;
            }
            
            .card:nth-child(5) {
                page-break-before: avoid;
            }
            
            .card h2 {
                font-size: 11pt;
                margin-bottom: 8px;
            }
            
            /* Chart dimensions for grid cards */
            .card .chart-wrapper {
                height: 160px !important;
                min-height: 160px !important;
                max-height: 160px !important;
                width: 100% !important;
                margin-bottom: 8px;
                position: relative;
            }
            
            .card canvas {
                max-height: 160px !important;
                height: 160px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* Hide sliders in print */
            .slider-container {
                display: none !important;
            }
            
            /* Hide country selector in print */
            .country-selector {
                display: none !important;
            }
            
            /* Metrics grid adjustments */
            .wide-metrics-grid {
                margin-top: 8px;
                page-break-inside: avoid;
                padding-top: 0;
                gap: 4px;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .metric {
                background: #f9f9f9;
                border: 1px solid #ccc;
                padding: 4px 6px;
                font-size: 8pt;
                margin: 0;
            }
            
            .metric-value {
                font-size: 9pt;
            }
            
            .trend {
                font-size: 6pt;
                padding: 1px 2px;
            }
            
            /* Citations */
            .citation {
                font-size: 7pt;
                color: #666;
                page-break-inside: avoid;
                margin-top: 5px;
                font-style: italic;
            }
            
            /* Hide interactive elements */
            .slider-left, .slider-right, .slider-track, .slider-range {
                display: none !important;
            }
            
            /* Ensure live indicator is hidden */
            .live-indicator {
                display: none !important;
            }
            
            /* Chart.js specific adjustments for print */
            canvas {
                image-rendering: optimizeQuality;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Page setup */
            @page {
                size: A4 portrait;
                margin: 15mm 10mm;
            }
            
            @page:first {
                margin-top: 10mm;
            }
        }
        
        /* Responsive adjustments */
        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .wide-metrics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1200px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>Geo√∏konomisk Dashboard</h1>
        
        <div class="status-bar">
            <div class="status">
                <span id="dataStatus">Loading data...</span>
                <span class="live-indicator" id="liveIndicator" style="display:none;"></span>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <button id="printButton" class="print-button" onclick="window.print()">
                    üìÑ Print til PDF
                </button>
                <div class="status">Sidste opdatering: <span id="lastUpdate">--</span></div>
            </div>
        </div>

        <!-- Trade Openness Chart - Full Width but Reduced Height -->
        <div class="wide-card">
            <h2>Handels√•benhed (Handel/BNP %)
                <div class="country-selector">
                    <button class="dropdown-button" id="countryDropdownBtn">
                        V√¶lg lande ‚ñº
                    </button>
                    <div class="dropdown-content" id="countryDropdown">
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="World" checked> Verden
                                <span class="country-color" style="background: #4D4D4D;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="EU" checked> EU
                                <span class="country-color" style="background: #F5D547;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Denmark" checked> Danmark
                                <span class="country-color" style="background: #C60C30;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="China" checked> Kina
                                <span class="country-color" style="background: #EE3A36;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="India" checked> Indien
                                <span class="country-color" style="background: #FF9933;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="USA" checked> USA
                                <span class="country-color" style="background: #005A8C;"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </h2>
            <div class="slider-container">
                <div class="slider-wrapper">
                    <div class="slider-track"></div>
                    <div class="slider-range" id="tradeRange"></div>
                    <input type="range" class="slider-left" id="tradeMin" min="2000" max="2024" value="2000">
                    <input type="range" class="slider-right" id="tradeMax" min="2000" max="2024" value="2024">
                </div>
                <div class="slider-labels">
                    <span>2000</span>
                    <span>2024</span>
                </div>
                <div class="slider-value-display" id="tradeDisplay">2000 - 2024</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="tradeOpennessChart"></canvas>
            </div>
            <div class="wide-metrics-grid">
                <div class="metric">
                    <span>Verden</span>
                    <span class="metric-value" id="worldTrade">--</span>
                    <span class="trend down" id="worldTradeTrend">--</span>
                </div>
                <div class="metric">
                    <span>EU</span>
                    <span class="metric-value" id="euTrade">--</span>
                    <span class="trend down" id="euTradeTrend">--</span>
                </div>
                <div class="metric">
                    <span>Kina</span>
                    <span class="metric-value" id="chinaTrade">--</span>
                    <span class="trend up" id="chinaTradeTrend">--</span>
                </div>
                <div class="metric">
                    <span>USA</span>
                    <span class="metric-value" id="usaTrade">--</span>
                    <span class="trend up" id="usaTradeTrend">--</span>
                </div>
                <div class="metric">
                    <span>Indien</span>
                    <span class="metric-value" id="indiaTrade">--</span>
                    <span class="trend up" id="indiaTradeTrend">--</span>
                </div>
                <div class="metric">
                    <span>Danmark</span>
                    <span class="metric-value" id="denmarkTrade">--</span>
                    <span class="trend up" id="denmarkTradeTrend">--</span>
                </div>
            </div>
            <div class="citation">
                Source: World Bank - Trade (% of GDP) Indicator
            </div>
        </div>

        <!-- Export Volumes Chart - New Wide Card -->
        <div class="wide-card">
            <h2>Eksportvolumen (M√•nedlig)
                <div class="country-selector">
                    <button class="dropdown-button" id="exportDropdownBtn">
                        V√¶lg lande ‚ñº
                    </button>
                    <div class="dropdown-content" id="exportDropdown">
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="EU27" checked> EU27
                                <span class="country-color" style="background: #F5D547;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="USA" checked> USA
                                <span class="country-color" style="background: #005A8C;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Indien" checked> Indien
                                <span class="country-color" style="background: #FF9933;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Vietnam"> Vietnam
                                <span class="country-color" style="background: #DA251D;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Thailand"> Thailand
                                <span class="country-color" style="background: #A51931;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Mexico"> Mexico
                                <span class="country-color" style="background: #006847;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Rusland"> Rusland
                                <span class="country-color" style="background: #0033A0;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Afrika"> Afrika
                                <span class="country-color" style="background: #8B4513;"></span>
                            </label>
                        </div>
                        <div class="dropdown-item">
                            <label>
                                <input type="checkbox" value="Ungarn"> Ungarn
                                <span class="country-color" style="background: #CE2939;"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </h2>
            <div class="slider-container">
                <div class="slider-wrapper">
                    <div class="slider-track"></div>
                    <div class="slider-range" id="exportRange"></div>
                    <input type="range" class="slider-left" id="exportMin" min="0" max="77" value="0">
                    <input type="range" class="slider-right" id="exportMax" min="0" max="77" value="77">
                </div>
                <div class="slider-labels">
                    <span>Mar-19</span>
                    <span>Aug-25</span>
                </div>
                <div class="slider-value-display" id="exportDisplay">Mar-19 - Aug-25</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="exportChart"></canvas>
            </div>
            <div class="wide-metrics-grid" id="exportMetrics">
                <div class="metric">
                    <span>EU27</span>
                    <span class="metric-value" id="eu27Export">--</span>
                    <span class="trend" id="eu27Trend">--</span>
                </div>
                <div class="metric">
                    <span>USA</span>
                    <span class="metric-value" id="usaExport">--</span>
                    <span class="trend" id="usaExportTrend">--</span>
                </div>
                <div class="metric">
                    <span>Indien</span>
                    <span class="metric-value" id="indiaExport">--</span>
                    <span class="trend" id="indiaExportTrend">--</span>
                </div>
                <div class="metric">
                    <span>Vietnam</span>
                    <span class="metric-value" id="vietnamExport">--</span>
                    <span class="trend" id="vietnamTrend">--</span>
                </div>
                <div class="metric">
                    <span>Thailand</span>
                    <span class="metric-value" id="thailandExport">--</span>
                    <span class="trend" id="thailandTrend">--</span>
                </div>
                <div class="metric">
                    <span>Mexico</span>
                    <span class="metric-value" id="mexicoExport">--</span>
                    <span class="trend" id="mexicoTrend">--</span>
                </div>
            </div>
            <div class="citation">
                Source: Kinesisk tolddata fra UNCOMTRADE
            </div>
        </div>

        <div class="grid">
            <!-- Currency Usage Trends - NO SLIDER -->
            <div class="card">
                <h2>Reservevaluta Status</h2>
                <div class="chart-wrapper">
                    <canvas id="currencyChart"></canvas>
                </div>
                <div class="metric">
                    <span>USD Dominance</span>
                    <span class="metric-value" id="usdShare">--</span>
                </div>
                <div class="citation">
                    Source: IMF Currency Composition of Official Foreign Exchange Reserves (COFER)
                </div>
            </div>

            <!-- FDI as % of GDP Comparison -->
            <div class="card">
                <h2>Indg√•ende FDI % af BNP (√•benhed)</h2>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <div class="slider-track"></div>
                        <div class="slider-range" id="fdiRange"></div>
                        <input type="range" class="slider-left" id="fdiMin" min="2015" max="2025" value="2015">
                        <input type="range" class="slider-right" id="fdiMax" min="2015" max="2025" value="2025">
                    </div>
                    <div class="slider-labels">
                        <span>2015</span>
                        <span>2025</span>
                    </div>
                    <div class="slider-value-display" id="fdiDisplay">2015 - 2025</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="fdiGdpChart"></canvas>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px;">
                    <div class="metric">
                        <span>USA</span>
                        <span class="metric-value" id="usaFdi">--</span>
                        <span class="trend down" id="usaTrend">--</span>
                    </div>
                    <div class="metric">
                        <span>Kina</span>
                        <span class="metric-value" id="chinaFdi">--</span>
                        <span class="trend down" id="chinaTrend">--</span>
                    </div>
                    <div class="metric">
                        <span>EU</span>
                        <span class="metric-value" id="euFdi">--</span>
                        <span class="trend down" id="euTrend">--</span>
                    </div>
                </div>
                <div class="citation">
                    Source: World Bank Foreign Direct Investment Database
                </div>
            </div>

            <!-- Harmful Trade Restrictions -->
            <div class="card">
                <h2>Skadelige handelsrestriktioner</h2>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <div class="slider-track"></div>
                        <div class="slider-range" id="restrictionsRange"></div>
                        <input type="range" class="slider-left" id="restrictionsMin" min="2009" max="2025" value="2009">
                        <input type="range" class="slider-right" id="restrictionsMax" min="2009" max="2025" value="2025">
                    </div>
                    <div class="slider-labels">
                        <span>2009</span>
                        <span>2025</span>
                    </div>
                    <div class="slider-value-display" id="restrictionsDisplay">2009 - 2025</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="restrictionsChart"></canvas>
                </div>
                <div class="metric">
                    <span>Samlede restriktioner</span>
                    <span class="metric-value" id="totalRestrictions">--</span>
                    <span class="trend up" id="restrictionsTrend">--</span>
                </div>
                <div class="citation">
                    Source: Global Trade Alert Database
                </div>
            </div>

            <!-- Geopolitical Risk Index -->
            <div class="card">
                <h2>Geopolitisk Risiko Indeks</h2>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <div class="slider-track"></div>
                        <div class="slider-range" id="geoRange"></div>
                        <input type="range" class="slider-left" id="geoMin" min="0" max="67" value="0">
                        <input type="range" class="slider-right" id="geoMax" min="0" max="67" value="67">
                    </div>
                    <div class="slider-labels">
                        <span>Jan-20</span>
                        <span>Aug-25</span>
                    </div>
                    <div class="slider-value-display" id="geoDisplay">Jan-20 - Aug-25</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="geoRiskChart"></canvas>
                </div>
                <div class="metric">
                    <span>Nuv√¶rende risikoniveau</span>
                    <span class="metric-value" id="currentRisk">--</span>
                    <span class="trend up" id="riskTrend">--</span>
                </div>
                <div class="citation">
                    Source: Caldara, Dario and Matteo Iacoviello (2022), "Measuring Geopolitical Risk"
                </div>
            </div>

            <!-- Trade Policy Uncertainty Index -->
            <div class="card">
                <h2>Handelspolitisk Usikkerhedsindeks</h2>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <div class="slider-track"></div>
                        <div class="slider-range" id="tpuRange"></div>
                        <input type="range" class="slider-left" id="tpuMin" min="0" max="67" value="0">
                        <input type="range" class="slider-right" id="tpuMax" min="0" max="67" value="67">
                    </div>
                    <div class="slider-labels">
                        <span>Jan-20</span>
                        <span>Aug-25</span>
                    </div>
                    <div class="slider-value-display" id="tpuDisplay">Jan-20 - Aug-25</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="tpuChart"></canvas>
                </div>
                <div class="metric">
                    <span>Nuv√¶rende TPU niveau</span>
                    <span class="metric-value" id="currentTPU">--</span>
                    <span class="trend up" id="tpuTrend">--</span>
                </div>
                <div class="citation">
                    Source: Caldara, D., Iacoviello, M., Molligo, P., Prestipino, A., & Raffo, A. (2020). 
                    "The economic effects of trade policy uncertainty."
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            staticDataPath: 'data/',
            githubRepo: 'mathov92/geofrag-dashboard',
            updateInterval: 300000
        };

        // Data Manager
        class DataManager {
            constructor() {
                this.cache = {};
                this.lastUpdate = null;
                this.originalData = null;
            }

            parseExportData(tsvText) {
                const lines = tsvText.trim().split('\n');
                const headers = lines[0].split('\t');
                const dates = headers.slice(1);
                
                const exportData = {
                    dates: dates,
                    countries: {}
                };
                
                for (let i = 1; i < lines.length; i++) {
                    const parts = lines[i].split('\t');
                    const country = parts[0];
                    const values = parts.slice(1).map(v => {
                        // Parse the value, removing spaces and converting to number
                        const cleaned = v.replace(/\s/g, '').replace(/\./g, '');
                        return parseFloat(cleaned) || 0;
                    });
                    exportData.countries[country] = values;
                }
                
                return exportData;
            }

            async loadStaticData() {
                try {
                    // Parse the export data from the TSV
                    const exportTSV = `	2019-03	2019-04	2019-05	2019-06	2019-07	2019-08	2019-09	2019-10	2019-11	2019-12	2020-01	2020-02	2020-03	2020-04	2020-05	2020-06	2020-07	2020-08	2020-09	2020-10	2020-11	2020-12	2021-01	2021-02	2021-03	2021-04	2021-05	2021-06	2021-07	2021-08	2021-09	2021-10	2021-11	2021-12	2022-01	2022-02	2022-03	2022-04	2022-05	2022-06	2022-07	2022-08	2022-09	2022-10	2022-11	2022-12	2023-01	2023-02	2023-03	2023-04	2023-05	2023-06	2023-07	2023-08	2023-09	2023-10	2023-11	2023-12	2024-01	2024-02	2024-03	2024-04	2024-05	2024-06	2024-07	2024-08	2024-09	2024-10	2024-11	2024-12	2025-01	2025-02	2025-03	2025-04	2025-05	2025-06	2025-07	2025-08
EU27	 28.003.967.112 	 26.668.330.476 	 29.599.900.364 	 30.321.679.631 	 31.556.918.652 	 31.930.555.835 	 32.114.672.045 	 31.388.754.550 	 30.648.724.497 	 31.801.219.990 	 32.972.772.026 	 26.674.400.083 	 23.463.970.726 	 22.729.678.104 	 30.829.651.588 	 33.746.190.845 	 35.316.818.093 	 35.348.481.596 	 35.556.646.873 	 34.441.339.655 	 35.095.538.832 	 37.654.479.564 	 39.756.721.214 	 38.469.354.798 	 36.542.571.425 	 36.415.206.877 	 38.379.751.881 	 40.430.036.886 	 41.559.168.275 	 43.659.042.612 	 44.099.721.520 	 45.871.462.351 	 47.169.387.993 	 50.015.613.704 	 51.281.605.493 	 47.619.811.043 	 44.951.557.358 	 41.874.636.323 	 44.925.879.607 	 46.951.108.824 	 50.508.199.504 	 51.651.716.865 	 50.425.422.848 	 47.294.067.944 	 45.059.991.043 	 43.904.295.646 	 44.900.319.043 	 40.867.770.474 	 41.494.705.841 	 40.597.279.127 	 44.648.733.872 	 44.249.975.594 	 43.602.145.056 	 42.494.808.564 	 41.699.996.363 	 40.490.720.849 	 39.572.327.632 	 39.993.216.832 	 41.713.802.325 	 40.482.594.022 	 39.291.149.442 	 39.089.572.170 	 42.210.766.661 	 44.392.280.594 	 45.250.436.539 	 46.138.365.112 	 44.911.871.755 	 44.153.976.280 	 42.231.966.018 	 43.742.232.864 	 45.088.263.892 	 41.183.200.065 	 39.573.245.276 	 38.920.748.543 	 45.286.853.071 	 47.366.489.905 	 48.317.138.971 	 48.935.318.830 
Afrika	 7.168.067.929 	 6.869.666.213 	 8.397.641.296 	 8.809.867.574 	 9.166.218.599 	 8.958.433.242 	 8.992.520.762 	 8.656.947.768 	 8.648.034.618 	 9.557.508.764 	 10.063.679.212 	 7.943.994.500 	 6.568.348.176 	 5.854.532.083 	 7.737.138.395 	 8.290.395.979 	 8.781.763.863 	 9.319.808.319 	 9.645.745.883 	 9.658.314.283 	 9.992.689.689 	 10.701.956.931 	 11.400.567.325 	 10.374.952.392 	 9.222.826.368 	 8.912.141.117 	 10.151.034.782 	 11.428.092.258 	 11.836.037.286 	 12.320.027.910 	 12.430.152.322 	 12.596.912.650 	 12.518.366.747 	 12.550.726.223 	 13.209.020.627 	 11.559.639.899 	 10.903.512.125 	 9.653.380.815 	 11.469.798.145 	 12.898.815.708 	 14.095.756.491 	 14.332.991.018 	 13.847.595.511 	 13.377.647.866 	 13.150.331.406 	 12.993.059.339 	 13.438.832.396 	 11.766.809.635 	 12.406.033.645 	 12.849.334.227 	 15.122.729.129 	 14.794.482.266 	 14.146.361.940 	 13.555.123.675 	 13.394.632.965 	 13.048.080.785 	 13.233.647.529 	 13.421.912.001 	 14.551.642.045 	 13.572.237.769 	 12.768.777.766 	 11.906.469.653 	 12.833.343.811 	 13.389.934.166 	 13.096.417.001 	 13.171.397.956 	 13.145.457.366 	 14.025.133.117 	 14.471.578.835 	 15.946.287.192 	 16.121.505.748 	 13.889.562.019 	 12.904.714.963 	 12.748.044.023 	 15.408.436.613 	 15.997.634.104 	 16.363.602.671 	 16.099.096.189 
Thailand	 3.285.687.106 	 3.054.778.581 	 3.609.355.868 	 3.690.890.538 	 3.953.372.348 	 3.811.470.576 	 3.793.408.754 	 3.838.074.311 	 4.146.453.832 	 4.424.959.911 	 4.447.541.872 	 3.545.715.107 	 3.443.636.565 	 3.491.595.334 	 4.229.154.417 	 4.134.063.955 	 4.268.335.144 	 4.381.098.391 	 4.508.488.352 	 4.314.576.384 	 4.418.709.531 	 4.751.536.445 	 5.220.242.768 	 4.978.070.273 	 4.913.457.412 	 5.051.499.610 	 5.702.563.585 	 5.752.431.607 	 5.700.352.225 	 5.682.992.661 	 5.818.396.336 	 5.656.797.871 	 5.849.883.711 	 6.258.779.660 	 6.878.029.924 	 6.109.543.834 	 5.847.083.063 	 5.511.257.821 	 6.357.269.866 	 6.708.008.979 	 6.922.940.119 	 6.791.942.906 	 6.526.698.130 	 6.363.450.096 	 6.404.958.685 	 6.390.502.201 	 6.405.833.282 	 5.989.076.133 	 6.370.330.601 	 6.565.091.003 	 6.837.008.958 	 6.308.673.526 	 5.993.557.870 	 5.956.110.213 	 6.058.095.484 	 6.135.939.410 	 6.425.411.992 	 6.565.336.156 	 6.877.265.566 	 6.390.791.210 	 6.672.985.429 	 6.692.650.591 	 7.336.136.515 	 7.146.641.150 	 7.020.221.593 	 6.883.938.082 	 6.833.491.169 	 6.983.338.922 	 7.427.223.212 	 8.022.499.390 	 8.359.226.679 	 7.550.935.478 	 7.906.080.123 	 8.231.600.070 	 9.276.024.609 	 9.050.150.751 	 8.848.524.574 	 8.743.063.605 
Mexico	 3.356.549.184 	 3.299.402.409 	 3.722.053.629 	 3.715.609.235 	 3.910.411.224 	 4.072.449.462 	 4.428.491.011 	 4.368.554.489 	 4.157.304.238 	 3.960.072.072 	 3.957.867.198 	 3.238.855.021 	 3.033.467.286 	 2.823.439.635 	 3.436.742.767 	 3.465.096.113 	 3.578.449.159 	 3.865.363.929 	 4.042.277.166 	 4.219.989.465 	 4.293.399.713 	 4.401.723.825 	 4.640.185.717 	 4.498.195.900 	 4.506.623.352 	 4.519.169.884 	 4.840.137.547 	 5.270.041.089 	 5.671.394.150 	 6.090.919.079 	 6.249.422.156 	 6.151.175.814 	 6.244.116.758 	 6.281.849.756 	 6.602.134.712 	 5.946.583.851 	 5.803.984.892 	 5.432.694.355 	 5.940.825.615 	 6.418.394.218 	 6.936.173.840 	 7.370.996.184 	 7.242.601.947 	 6.838.301.875 	 6.472.915.620 	 6.233.217.977 	 6.419.795.604 	 5.802.360.601 	 6.070.696.155 	 6.144.403.839 	 7.040.142.503 	 6.975.525.006 	 7.095.193.691 	 7.240.858.378 	 7.352.922.174 	 7.184.375.831 	 6.936.036.840 	 6.780.416.199 	 7.040.713.682 	 6.751.341.695 	 6.812.236.764 	 6.822.177.906 	 7.485.963.373 	 7.986.106.424 	 8.196.795.601 	 8.383.610.093 	 8.012.523.743 	 7.780.084.137 	 7.271.599.545 	 7.265.581.103 	 7.416.440.326 	 6.829.424.162 	 6.906.130.282 	 6.809.040.724 	 7.678.045.062 	 7.640.238.968 	 7.738.065.406 	 7.789.599.822 
USA	 30.478.776.043 	 28.727.908.404 	 33.746.356.054 	 36.203.107.462 	 38.703.723.384 	 38.570.823.954 	 37.666.051.563 	 36.645.343.249 	 36.080.373.756 	 35.426.281.145 	 34.295.922.713 	 25.889.111.267 	 22.772.831.252 	 22.621.741.768 	 31.579.134.105 	 36.434.869.105 	 40.318.029.947 	 42.780.662.757 	 44.150.832.239 	 44.194.760.600 	 46.603.480.439 	 47.472.426.182 	 47.532.198.515 	 42.193.470.060 	 39.404.786.219 	 38.462.526.882 	 41.088.368.354 	 43.635.969.685 	 45.986.042.819 	 48.311.661.391 	 51.908.582.161 	 53.539.150.898 	 54.707.946.177 	 54.442.296.086 	 53.878.060.349 	 48.882.783.359 	 45.912.782.338 	 43.890.491.489 	 47.992.176.961 	 50.823.053.750 	 53.868.224.144 	 53.148.766.805 	 51.482.830.462 	 48.873.308.157 	 45.906.977.946 	 43.925.557.461 	 42.874.391.719 	 38.209.642.630 	 37.357.125.943 	 36.889.910.237 	 42.115.331.618 	 42.327.842.600 	 42.396.067.894 	 43.339.493.064 	 44.515.670.222 	 44.809.918.650 	 44.498.804.042 	 43.239.036.593 	 43.032.607.358 	 38.766.019.093 	 36.953.808.450 	 36.705.695.272 	 40.922.608.375 	 43.828.756.522 	 45.138.791.977 	 46.244.839.980 	 46.742.783.803 	 47.042.640.977 	 47.045.665.863 	 47.690.906.057 	 48.154.186.625 	 41.679.081.310 	 38.737.774.066 	 33.747.284.711 	 34.125.192.011 	 33.547.350.303 	 34.500.702.405 	 35.366.887.223 
Rusland	 3.572.872.129 	 3.374.408.684 	 3.724.238.475 	 3.851.176.871 	 4.125.675.263 	 4.351.042.498 	 4.522.761.133 	 4.468.660.872 	 4.498.357.194 	 4.636.018.703 	 4.652.149.615 	 3.650.730.058 	 3.052.446.491 	 2.890.224.048 	 3.637.184.487 	 3.920.303.880 	 4.228.497.060 	 4.692.415.310 	 4.958.779.488 	 4.902.615.941 	 4.750.831.385 	 4.903.267.492 	 4.912.197.023 	 4.709.974.959 	 4.339.283.257 	 4.453.862.336 	 4.636.248.102 	 5.254.271.947 	 5.389.680.401 	 5.917.474.934 	 6.111.989.148 	 6.105.915.630 	 6.184.725.236 	 6.693.363.246 	 7.307.949.689 	 6.864.590.661 	 5.436.804.536 	 4.250.386.651 	 3.947.588.926 	 4.336.367.562 	 5.314.649.433 	 6.522.872.411 	 7.503.735.993 	 7.716.812.982 	 7.627.155.124 	 7.902.703.234 	 8.130.569.852 	 7.893.282.288 	 7.943.145.876 	 8.461.807.961 	 9.238.804.822 	 9.452.094.760 	 9.682.605.109 	 9.697.417.435 	 9.735.301.275 	 9.209.588.080 	 9.542.213.060 	 9.895.363.289 	 10.066.091.982 	 9.165.244.998 	 8.082.900.585 	 7.781.386.797 	 8.276.019.740 	 9.085.486.080 	 9.646.392.045 	 10.036.736.386 	 10.486.677.542 	 10.821.132.322 	 10.749.362.187 	 10.770.222.955 	 10.178.016.518 	 8.771.337.906 	 7.602.301.358 	 7.241.996.474 	 8.023.969.283 	 8.204.295.148 	 8.531.439.606 	 8.666.234.860 
Vietnam	 6.663.796.737 	 6.858.409.341 	 8.345.252.551 	 8.170.904.736 	 8.331.422.204 	 8.399.770.562 	 8.325.057.607 	 8.524.357.727 	 8.764.034.568 	 9.463.201.645 	 8.900.669.866 	 7.060.600.548 	 7.022.606.403 	 7.498.173.315 	 9.006.268.904 	 8.702.773.290 	 9.113.495.165 	 9.539.547.890 	 10.182.673.434 	 10.566.202.871 	 11.331.685.904 	 12.030.359.991 	 12.548.424.437 	 10.952.753.527 	 10.640.132.784 	 10.687.635.022 	 12.183.019.007 	 12.017.678.359 	 11.659.464.898 	 11.394.396.925 	 10.954.786.937 	 10.664.048.743 	 11.222.454.120 	 11.782.890.892 	 12.336.146.743 	 10.545.251.452 	 10.094.649.427 	 10.149.046.793 	 12.471.264.496 	 13.214.700.186 	 13.074.257.766 	 12.317.295.751 	 12.200.769.064 	 12.191.344.858 	 12.276.253.320 	 12.132.935.356 	 10.869.532.409 	 9.947.768.980 	 10.417.004.018 	 11.442.299.612 	 11.816.109.766 	 10.886.989.440 	 10.776.357.521 	 11.317.406.426 	 11.902.807.791 	 12.128.085.457 	 12.355.885.874 	 12.823.038.363 	 13.433.007.648 	 11.846.062.622 	 12.170.716.095 	 12.317.092.754 	 14.314.246.753 	 13.769.406.754 	 13.557.077.122 	 13.303.190.095 	 13.390.921.542 	 13.474.444.253 	 13.848.605.435 	 14.619.375.824 	 14.629.186.334 	 13.532.214.065 	 14.135.195.424 	 15.345.286.636 	 17.419.803.337 	 17.038.014.836 	 17.011.084.484 	 17.065.471.069 
Indien	 5.717.693.543 	 5.252.913.095 	 5.989.365.318 	 6.201.484.269 	 6.792.956.551 	 6.899.232.760 	 6.838.845.615 	 6.366.547.275 	 6.021.152.845 	 6.183.742.950 	 6.602.540.839 	 5.507.780.805 	 5.141.319.251 	 3.893.758.778 	 4.091.061.356 	 3.741.704.031 	 4.539.127.374 	 5.523.384.179 	 6.162.020.107 	 6.542.668.050 	 6.853.552.919 	 7.194.780.474 	 7.518.143.873 	 7.287.396.966 	 7.008.223.366 	 7.014.841.280 	 7.156.944.772 	 7.114.407.104 	 6.925.854.231 	 7.462.854.984 	 8.438.743.795 	 9.307.065.728 	 9.627.532.877 	 9.560.976.923 	 9.805.764.731 	 9.081.016.562 	 8.930.657.758 	 8.439.846.129 	 9.259.186.033 	 9.945.019.187 	 10.617.153.657 	 10.631.776.408 	 10.590.104.735 	 10.055.045.012 	 9.876.015.699 	 9.436.438.360 	 9.708.898.460 	 8.977.041.175 	 9.156.075.172 	 8.957.348.675 	 9.779.717.147 	 9.633.005.539 	 9.793.476.008 	 9.968.737.510 	 10.498.724.937 	 10.274.592.465 	 10.276.216.538 	 9.986.755.145 	 10.643.294.305 	 9.970.374.757 	 9.308.043.885 	 8.552.670.072 	 9.179.886.752 	 9.762.556.953 	 10.376.674.951 	 10.886.267.319 	 10.903.376.728 	 10.513.597.953 	 10.118.542.277 	 10.180.446.148 	 11.033.694.194 	 10.521.739.710 	 10.650.763.367 	 10.257.303.312 	 11.100.221.800 	 11.241.763.046 	 11.551.126.394 	 11.972.215.249 
Ungarn	 532.136.875 	 504.895.165 	 522.863.800 	 506.895.791 	 530.202.889 	 552.261.212 	 590.762.587 	 593.980.091 	 569.532.830 	 527.823.100 	 546.899.307 	 460.471.522 	 469.890.026 	 481.940.251 	 639.572.011 	 712.754.593 	 727.718.101 	 684.005.310 	 652.973.963 	 623.637.856 	 637.774.064 	 632.282.609 	 692.594.644 	 738.226.768 	 790.954.004 	 775.036.802 	 757.124.398 	 796.046.704 	 797.652.900 	 854.565.678 	 895.103.116 	 931.797.104 	 940.588.132 	 889.941.789 	 906.517.716 	 843.020.588 	 841.043.725 	 797.955.937 	 838.094.891 	 827.620.902 	 881.786.849 	 920.685.574 	 961.848.324 	 915.854.720 	 905.780.894 	 851.896.059 	 887.744.616 	 823.613.976 	 849.471.730 	 791.952.337 	 816.083.950 	 774.427.900 	 791.644.412 	 786.967.262 	 823.493.333 	 825.134.009 	 838.821.704 	 818.336.040 	 831.801.999 	 809.010.521 	 832.130.541 	 851.976.463 	 919.436.760 	 968.737.639 	 995.107.225 	 1.007.377.738 	 984.579.088 	 976.171.988 	 985.939.470 	 1.017.901.346 	 1.041.028.580 	 1.010.170.541 	 1.100.028.211 	 1.196.403.348 	 1.345.732.496 	 1.372.633.041 	 1.404.194.765 	 1.456.710.502 `;
                    
                    const exportData = this.parseExportData(exportTSV);

                    const data = {
                        tradeOpenness: {
                            years: [2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                            World: [50.36, 49.23, 49.27, 50.92, 54.48, 56.52, 58.67, 59.05, 60.68, 52.19, 56.53, 59.66, 59.47, 58.75, 58.14, 55.77, 53.98, 55.70, 57.20, 55.96, 52.06, 56.85, 62.61, 58.37, 56.56],
                            EU: [71.57, 70.73, 68.44, 67.36, 70.40, 73.55, 77.98, 79.80, 80.78, 70.50, 78.27, 83.46, 85.07, 84.62, 85.34, 86.57, 85.61, 88.62, 90.34, 90.43, 83.69, 91.09, 103.63, 95.64, 92.15],
                            China: [39.01, 38.08, 42.19, 51.08, 58.64, 61.36, 63.57, 61.27, 56.71, 44.42, 49.85, 49.95, 47.48, 45.92, 44.07, 38.70, 36.18, 36.95, 36.89, 35.20, 34.04, 36.52, 37.44, 36.11, 37.20],
                            USA: [25.10, 22.97, 22.29, 22.63, 24.45, 25.64, 26.50, 27.20, 28.40, 24.80, 28.00, 30.50, 30.00, 29.50, 29.00, 27.50, 26.40, 27.00, 27.50, 26.90, 25.00, 27.30, 29.80, 28.20, 27.80],
                            India: [26.90, 25.99, 29.51, 30.59, 37.50, 42.00, 45.72, 45.69, 53.37, 46.27, 49.26, 55.62, 55.79, 53.84, 48.92, 41.92, 40.08, 40.74, 43.62, 39.91, 37.76, 45.42, 50.08, 44.99, 44.67],
                            Denmark: [83.04, 83.92, 84.48, 80.76, 82.01, 89.40, 97.43, 100.05, 104.47, 89.39, 94.39, 102.01, 104.36, 103.61, 103.21, 105.13, 101.45, 104.22, 108.81, 111.89, 104.43, 111.41, 131.54, 127.77, 128.64]
                        },
                        currencyData: {
                            labels: ['USD', 'EUR', 'CNY', 'JPY', 'GBP', 'Other'],
                            current: [59.2, 20.1, 12.3, 5.2, 4.9, 8.3]
                        },
                        fdiGdpData: {
                            years: [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
                            USA: [2.43, 2.67, 1.87, 1.44, 1.65, 1.98, 2.11, 1.53, 1.42, 1.38, 1.35],
                            China: [2.23, 1.56, 1.35, 1.68, 1.34, 1.54, 1.95, 0.89, 0.52, 0.48, 0.45],
                            EU: [3.87, 2.94, 2.45, 1.82, 2.73, 3.45, 2.89, 2.13, 1.76, 1.82, 1.79]
                        },
                        tradeRestrictions: {
                            years: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
                            G7: [145, 187, 234, 276, 298, 342, 389, 456, 487, 542, 589, 687, 745, 812, 867, 923, 945],
                            BRICS: [89, 112, 156, 189, 213, 267, 298, 334, 378, 423, 468, 534, 589, 634, 689, 734, 756]
                        },
                        geoRiskIndex: {
                            dates: ['Jan-20', 'Feb-20', 'Mar-20', 'Apr-20', 'May-20', 'Jun-20', 'Jul-20', 'Aug-20', 'Sep-20', 'Oct-20', 'Nov-20', 'Dec-20',
                                   'Jan-21', 'Feb-21', 'Mar-21', 'Apr-21', 'May-21', 'Jun-21', 'Jul-21', 'Aug-21', 'Sep-21', 'Oct-21', 'Nov-21', 'Dec-21',
                                   'Jan-22', 'Feb-22', 'Mar-22', 'Apr-22', 'May-22', 'Jun-22', 'Jul-22', 'Aug-22', 'Sep-22', 'Oct-22', 'Nov-22', 'Dec-22',
                                   'Jan-23', 'Feb-23', 'Mar-23', 'Apr-23', 'May-23', 'Jun-23', 'Jul-23', 'Aug-23', 'Sep-23', 'Oct-23', 'Nov-23', 'Dec-23',
                                   'Jan-24', 'Feb-24', 'Mar-24', 'Apr-24', 'May-24', 'Jun-24', 'Jul-24', 'Aug-24', 'Sep-24', 'Oct-24', 'Nov-24', 'Dec-24',
                                   'Jan-25', 'Feb-25', 'Mar-25', 'Apr-25', 'May-25', 'Jun-25', 'Jul-25', 'Aug-25'],
                            values: [138.42, 75.96, 81.54, 69.34, 68.51, 71.23, 66.47, 65.47, 80.38, 76.08, 70.07, 64.07,
                                    77.42, 73.96, 78.62, 88.17, 93.01, 74.13, 58.42, 89.49, 80.70, 79.03, 86.57, 105.35,
                                    138.67, 216.16, 318.95, 191.14, 142.26, 130.71, 117.18, 132.86, 131.99, 143.16, 116.72, 111.20,
                                    104.27, 120.99, 105.38, 106.81, 108.47, 110.53, 107.45, 101.14, 98.63, 197.89, 156.70, 142.28,
                                    160.16, 146.60, 133.21, 163.74, 130.52, 112.88, 92.39, 140.76, 130.14, 130.69, 128.48, 142.13,
                                    112.33, 136.20, 172.85, 138.71, 165.41, 221.73, 134.99, 136.00]
                        },
                        tpuIndex: {
                            dates: ['Jan-20', 'Feb-20', 'Mar-20', 'Apr-20', 'May-20', 'Jun-20', 'Jul-20', 'Aug-20', 'Sep-20', 'Oct-20', 'Nov-20', 'Dec-20',
                                   'Jan-21', 'Feb-21', 'Mar-21', 'Apr-21', 'May-21', 'Jun-21', 'Jul-21', 'Aug-21', 'Sep-21', 'Oct-21', 'Nov-21', 'Dec-21',
                                   'Jan-22', 'Feb-22', 'Mar-22', 'Apr-22', 'May-22', 'Jun-22', 'Jul-22', 'Aug-22', 'Sep-22', 'Oct-22', 'Nov-22', 'Dec-22',
                                   'Jan-23', 'Feb-23', 'Mar-23', 'Apr-23', 'May-23', 'Jun-23', 'Jul-23', 'Aug-23', 'Sep-23', 'Oct-23', 'Nov-23', 'Dec-23',
                                   'Jan-24', 'Feb-24', 'Mar-24', 'Apr-24', 'May-24', 'Jun-24', 'Jul-24', 'Aug-24', 'Sep-24', 'Oct-24', 'Nov-24', 'Dec-24',
                                   'Jan-25', 'Feb-25', 'Mar-25', 'Apr-25', 'May-25', 'Jun-25', 'Jul-25', 'Aug-25'],
                            values: [1.40, 0.96, 0.61, 0.55, 0.67, 0.60, 0.57, 0.67, 0.68, 0.70, 0.70, 0.98,
                                    0.75, 0.37, 0.47, 0.48, 0.49, 0.49, 0.57, 0.39, 0.52, 0.56, 0.48, 0.37,
                                    0.47, 0.54, 0.54, 0.41, 0.63, 0.75, 0.67, 0.66, 0.49, 0.47, 0.49, 0.49,
                                    0.53, 0.44, 0.65, 0.34, 0.60, 0.52, 0.63, 0.60, 0.64, 0.44, 0.41, 0.65,
                                    0.70, 0.63, 0.82, 0.91, 0.94, 0.89, 1.01, 0.98, 1.29, 1.48, 3.73, 2.48,
                                    3.61, 4.70, 6.03, 11.51, 7.23, 4.73, 5.55, 5.76]
                        },
                        exportData: exportData
                    };
                    this.originalData = JSON.parse(JSON.stringify(data));
                    return data;
                } catch (error) {
                    console.error('Failed to load static data:', error);
                    return null;
                }
            }

            filterDataByYearRange(dataType, startYear, endYear) {
                const data = JSON.parse(JSON.stringify(this.originalData));
                
                switch(dataType) {
                    case 'trade':
                        const tradeStartIdx = data.tradeOpenness.years.findIndex(y => y >= startYear);
                        const tradeEndIdx = data.tradeOpenness.years.findIndex(y => y > endYear);
                        const tradeEnd = tradeEndIdx === -1 ? data.tradeOpenness.years.length : tradeEndIdx;
                        
                        if (tradeStartIdx === -1) return null;
                        
                        return {
                            years: data.tradeOpenness.years.slice(tradeStartIdx, tradeEnd),
                            World: data.tradeOpenness.World.slice(tradeStartIdx, tradeEnd),
                            EU: data.tradeOpenness.EU.slice(tradeStartIdx, tradeEnd),
                            China: data.tradeOpenness.China.slice(tradeStartIdx, tradeEnd),
                            USA: data.tradeOpenness.USA.slice(tradeStartIdx, tradeEnd),
                            India: data.tradeOpenness.India.slice(tradeStartIdx, tradeEnd),
                            Denmark: data.tradeOpenness.Denmark.slice(tradeStartIdx, tradeEnd)
                        };
                    
                    case 'fdi':
                        const fdiStartIdx = data.fdiGdpData.years.findIndex(y => y >= startYear);
                        const fdiEndIdx = data.fdiGdpData.years.findIndex(y => y > endYear);
                        const fdiEnd = fdiEndIdx === -1 ? data.fdiGdpData.years.length : fdiEndIdx;
                        
                        if (fdiStartIdx === -1) return null;
                        
                        return {
                            years: data.fdiGdpData.years.slice(fdiStartIdx, fdiEnd),
                            USA: data.fdiGdpData.USA.slice(fdiStartIdx, fdiEnd),
                            China: data.fdiGdpData.China.slice(fdiStartIdx, fdiEnd),
                            EU: data.fdiGdpData.EU.slice(fdiStartIdx, fdiEnd)
                        };
                    
                    case 'restrictions':
                        const resStartIdx = data.tradeRestrictions.years.findIndex(y => y >= startYear);
                        const resEndIdx = data.tradeRestrictions.years.findIndex(y => y > endYear);
                        const resEnd = resEndIdx === -1 ? data.tradeRestrictions.years.length : resEndIdx;
                        
                        if (resStartIdx === -1) return null;
                        
                        return {
                            years: data.tradeRestrictions.years.slice(resStartIdx, resEnd),
                            G7: data.tradeRestrictions.G7.slice(resStartIdx, resEnd),
                            BRICS: data.tradeRestrictions.BRICS.slice(resStartIdx, resEnd)
                        };
                    
                    case 'geo':
                        return {
                            dates: data.geoRiskIndex.dates.slice(startYear, endYear + 1),
                            values: data.geoRiskIndex.values.slice(startYear, endYear + 1)
                        };
                    
                    case 'tpu':
                        return {
                            dates: data.tpuIndex.dates.slice(startYear, endYear + 1),
                            values: data.tpuIndex.values.slice(startYear, endYear + 1)
                        };
                    
                    case 'export':
                        const filteredExport = {
                            dates: data.exportData.dates.slice(startYear, endYear + 1),
                            countries: {}
                        };
                        Object.keys(data.exportData.countries).forEach(country => {
                            filteredExport.countries[country] = data.exportData.countries[country].slice(startYear, endYear + 1);
                        });
                        return filteredExport;
                        
                    default:
                        return data;
                }
            }

            async fetchLiveData() {
                try {
                    const response = await fetch(`https://api.worldbank.org/v2/country/all/indicator/NY.GDP.MKTP.CD?format=json&date=2023`);
                    if (response.ok) {
                        const data = await response.json();
                        this.cache.liveGDP = data;
                        this.lastUpdate = new Date();
                        return true;
                    }
                } catch (error) {
                    console.log('Live data fetch failed, using cache');
                }
                return false;
            }
        }

        // Chart Manager
        class ChartManager {
            constructor() {
                this.charts = {};
            }

            initCharts(data) {
                // Trade Openness Chart - with adjusted height
                this.charts.tradeOpenness = new Chart(document.getElementById('tradeOpennessChart'), {
                    type: 'line',
                    data: {
                        labels: data.tradeOpenness.years,
                        datasets: [{
                            label: 'Verden',
                            data: data.tradeOpenness.World,
                            borderColor: '#4D4D4D',
                            backgroundColor: 'rgba(77, 77, 77, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'EU',
                            data: data.tradeOpenness.EU,
                            borderColor: '#F5D547',
                            backgroundColor: 'rgba(245, 213, 71, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Danmark',
                            data: data.tradeOpenness.Denmark,
                            borderColor: '#C60C30',
                            backgroundColor: 'rgba(198, 12, 48, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Kina',
                            data: data.tradeOpenness.China,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Indien',
                            data: data.tradeOpenness.India,
                            borderColor: '#FF9933',
                            backgroundColor: 'rgba(255, 153, 51, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'USA',
                            data: data.tradeOpenness.USA,
                            borderColor: '#005A8C',
                            backgroundColor: 'rgba(0, 90, 140, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: { 
                                    boxWidth: 12,
                                    padding: 10,
                                    font: { size: 11 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '√Ör',
                                    font: { size: 11 }
                                },
                                ticks: { font: { size: 10 } }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Handel % af BNP',
                                    font: { size: 11 }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    },
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });

                // Export Volume Chart - New
                const exportDatasets = [];
                const colorMap = {
                    'EU27': '#F5D547',
                    'USA': '#005A8C',
                    'Indien': '#FF9933',
                    'Vietnam': '#DA251D',
                    'Thailand': '#A51931',
                    'Mexico': '#006847',
                    'Rusland': '#0033A0',
                    'Afrika': '#8B4513',
                    'Ungarn': '#CE2939'
                };
                
                // Create datasets for selected countries (initially EU27, USA, Indien)
                const initialCountries = ['EU27', 'USA', 'Indien'];
                initialCountries.forEach(country => {
                    if (data.exportData.countries[country]) {
                        exportDatasets.push({
                            label: country,
                            data: data.exportData.countries[country],
                            borderColor: colorMap[country],
                            backgroundColor: `${colorMap[country]}20`,
                            tension: 0.0,
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        });
                    }
                });

                this.charts.export = new Chart(document.getElementById('exportChart'), {
                    type: 'line',
                    data: {
                        labels: data.exportData.dates,
                        datasets: exportDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    padding: 10,
                                    font: { size: 11 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.parsed.y / 1e9; // Convert to billions
                                        return context.dataset.label + ': ' + value.toFixed(2) + ' mia.';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'M√•ned',
                                    font: { size: 11 }
                                },
                                ticks: {
                                    font: { size: 10 },
                                    maxTicksLimit: 12,
                                    callback: function(val, index) {
                                        const label = this.getLabelForValue(val);
                                        // Show only January labels
                                        return label && label.includes('-01') ? label.substring(0, 7) : '';
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Eksportv√¶rdi',
                                    font: { size: 11 }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return (value / 1e9).toFixed(0) + ' mia.';
                                    },
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });

                // Currency Chart
                this.charts.currency = new Chart(document.getElementById('currencyChart'), {
                    type: 'bar',
                    data: {
                        labels: data.currencyData.labels,
                        datasets: [{
                            label: 'Share %',
                            data: data.currencyData.current,
                            backgroundColor: ['#005A8C', '#F5D547', '#EE3A36', '#6FA8DC', '#2A6965', '#A61E4C']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                max: 70,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });

                // FDI Chart
                this.charts.fdiGdp = new Chart(document.getElementById('fdiGdpChart'), {
                    type: 'line',
                    data: {
                        labels: data.fdiGdpData.years,
                        datasets: [{
                            label: 'USA',
                            data: data.fdiGdpData.USA,
                            borderColor: '#005A8C',
                            backgroundColor: 'rgba(0, 90, 140, 0.1)',
                            tension: 0.0
                        }, {
                            label: 'Kina',
                            data: data.fdiGdpData.China,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0
                        }, {
                            label: 'EU',
                            data: data.fdiGdpData.EU,
                            borderColor: '#F5D547',
                            backgroundColor: 'rgba(245, 213, 71, 0.1)',
                            tension: 0.0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: { 
                                    boxWidth: 12,
                                    padding: 8,
                                    font: { size: 11 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });

                // Trade Restrictions Chart
                this.charts.restrictions = new Chart(document.getElementById('restrictionsChart'), {
                    type: 'bar',
                    data: {
                        labels: data.tradeRestrictions.years,
                        datasets: [{
                            label: 'G7',
                            data: data.tradeRestrictions.G7,
                            backgroundColor: '#6FA8DC',
                            stack: 'Stack 0',
                        }, {
                            label: 'BRICS',
                            data: data.tradeRestrictions.BRICS,
                            backgroundColor: '#A61E4C',
                            stack: 'Stack 0',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: { 
                                    boxWidth: 12,
                                    font: { size: 11 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y + ' restriktioner';
                                    },
                                    footer: function(tooltipItems) {
                                        let sum = 0;
                                        tooltipItems.forEach(function(tooltipItem) {
                                            sum += tooltipItem.parsed.y;
                                        });
                                        return 'Total: ' + sum + ' restriktioner';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: '√Ör',
                                    font: { size: 11 }
                                }
                            },
                            y: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Antal restriktioner',
                                    font: { size: 11 }
                                }
                            }
                        }
                    }
                });

                // Geopolitical Risk Index Chart
                this.charts.geoRisk = new Chart(document.getElementById('geoRiskChart'), {
                    type: 'line',
                    data: {
                        labels: data.geoRiskIndex.dates,
                        datasets: [{
                            label: 'Geopolitisk Risiko Indeks',
                            data: data.geoRiskIndex.values,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0,
                            fill: true,
                            pointRadius: 1,
                            pointHoverRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        let event = '';
                                        if (context.label === 'Feb-22' || context.label === 'Mar-22') {
                                            event = ' (Ukraine krig)';
                                        } else if (context.label === 'Oct-23') {
                                            event = ' (Israel-Gaza)';
                                        } else if (context.label === 'Jun-25') {
                                            event = ' (Top: 221.73)';
                                        }
                                        return 'Risiko indeks: ' + value.toFixed(2) + event;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                ticks: {
                                    maxTicksLimit: 10,
                                    font: { size: 10 },
                                    callback: function(val, index) {
                                        const label = this.getLabelForValue(val);
                                        return label && label.includes('Jan') ? label : '';
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Risiko Indeks',
                                    font: { size: 11 }
                                }
                            }
                        }
                    }
                });

                // Trade Policy Uncertainty Index Chart
                this.charts.tpu = new Chart(document.getElementById('tpuChart'), {
                    type: 'line',
                    data: {
                        labels: data.tpuIndex.dates,
                        datasets: [{
                            label: 'TPU Indeks (% af artikler)',
                            data: data.tpuIndex.values,
                            borderColor: '#2A6965',
                            backgroundColor: 'rgba(42, 105, 101, 0.1)',
                            tension: 0.0,
                            fill: true,
                            pointRadius: 1,
                            pointHoverRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        let event = '';
                                        if (context.label === 'Nov-24') {
                                            event = ' (US valg)';
                                        } else if (context.label === 'Apr-25') {
                                            event = ' (Top: 11.51%)';
                                        }
                                        return 'TPU: ' + value.toFixed(2) + '%' + event;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                ticks: {
                                    maxTicksLimit: 10,
                                    font: { size: 10 },
                                    callback: function(val, index) {
                                        const label = this.getLabelForValue(val);
                                        return label && label.includes('Jan') ? label : '';
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Procent af artikler',
                                    font: { size: 11 }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(1) + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            updateChart(chartName, newData) {
                if (this.charts[chartName]) {
                    this.charts[chartName].data = newData;
                    this.charts[chartName].update();
                }
            }
        }

        // Global variables
        let dataManager;
        let chartManager;

        // Dual Range Slider Setup
        function setupDualRangeSlider(prefix, min, max, chartType, isMonthly = false) {
            const leftSlider = document.getElementById(prefix + 'Min');
            const rightSlider = document.getElementById(prefix + 'Max');
            const rangeBar = document.getElementById(prefix + 'Range');
            const displayElement = document.getElementById(prefix + 'Display');
            
            function updateSliders() {
                let minVal = parseInt(leftSlider.value);
                let maxVal = parseInt(rightSlider.value);
                
                // Prevent crossing
                if (minVal > maxVal - 1) {
                    leftSlider.value = maxVal - 1;
                    minVal = maxVal - 1;
                }
                if (maxVal < minVal + 1) {
                    rightSlider.value = minVal + 1;
                    maxVal = minVal + 1;
                }
                
                // Update range bar position
                const minPercent = ((minVal - min) / (max - min)) * 100;
                const maxPercent = ((maxVal - min) / (max - min)) * 100;
                rangeBar.style.left = minPercent + '%';
                rangeBar.style.width = (maxPercent - minPercent) + '%';
                
                // Update display
                if (isMonthly) {
                    const dates = dataManager.originalData[chartType === 'geo' ? 'geoRiskIndex' : 
                                                           chartType === 'tpu' ? 'tpuIndex' : 
                                                           'exportData'].dates;
                    displayElement.textContent = `${dates[minVal]} - ${dates[maxVal]}`;
                } else {
                    displayElement.textContent = `${minVal} - ${maxVal}`;
                }
                
                // Update chart
                updateChartByRange(chartType, minVal, maxVal);
            }
            
            leftSlider.addEventListener('input', updateSliders);
            rightSlider.addEventListener('input', updateSliders);
            
            // Initial update
            updateSliders();
        }

        // Update chart based on range selection
        function updateChartByRange(chartType, startValue, endValue) {
            const filteredData = dataManager.filterDataByYearRange(chartType, startValue, endValue);
            if (!filteredData) return;
            
            switch(chartType) {
                case 'trade':
                    chartManager.updateChart('tradeOpenness', {
                        labels: filteredData.years,
                        datasets: [{
                            label: 'Verden',
                            data: filteredData.World,
                            borderColor: '#4D4D4D',
                            backgroundColor: 'rgba(77, 77, 77, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'EU',
                            data: filteredData.EU,
                            borderColor: '#F5D547',
                            backgroundColor: 'rgba(245, 213, 71, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Danmark',
                            data: filteredData.Denmark,
                            borderColor: '#C60C30',
                            backgroundColor: 'rgba(198, 12, 48, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Kina',
                            data: filteredData.China,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'Indien',
                            data: filteredData.India,
                            borderColor: '#FF9933',
                            backgroundColor: 'rgba(255, 153, 51, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }, {
                            label: 'USA',
                            data: filteredData.USA,
                            borderColor: '#005A8C',
                            backgroundColor: 'rgba(0, 90, 140, 0.1)',
                            tension: 0.0,
                            borderWidth: 2
                        }]
                    });
                    updateTradeMetrics(filteredData);
                    break;
                
                case 'export':
                    updateExportChart(filteredData);
                    updateExportMetrics(filteredData);
                    break;
                
                case 'fdi':
                    chartManager.updateChart('fdiGdp', {
                        labels: filteredData.years,
                        datasets: [{
                            label: 'USA',
                            data: filteredData.USA,
                            borderColor: '#005A8C',
                            backgroundColor: 'rgba(0, 90, 140, 0.1)',
                            tension: 0.0
                        }, {
                            label: 'Kina',
                            data: filteredData.China,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0
                        }, {
                            label: 'EU',
                            data: filteredData.EU,
                            borderColor: '#F5D547',
                            backgroundColor: 'rgba(245, 213, 71, 0.1)',
                            tension: 0.0
                        }]
                    });
                    updateFdiMetrics(filteredData);
                    break;
                
                case 'restrictions':
                    chartManager.updateChart('restrictions', {
                        labels: filteredData.years,
                        datasets: [{
                            label: 'G7',
                            data: filteredData.G7,
                            backgroundColor: '#6FA8DC',
                            stack: 'Stack 0',
                        }, {
                            label: 'BRICS',
                            data: filteredData.BRICS,
                            backgroundColor: '#A61E4C',
                            stack: 'Stack 0',
                        }]
                    });
                    updateRestrictionsMetrics(filteredData);
                    break;
                
                case 'geo':
                    chartManager.updateChart('geoRisk', {
                        labels: filteredData.dates,
                        datasets: [{
                            label: 'Geopolitisk Risiko Indeks',
                            data: filteredData.values,
                            borderColor: '#EE3A36',
                            backgroundColor: 'rgba(238, 58, 54, 0.1)',
                            tension: 0.0,
                            fill: true,
                            pointRadius: 1,
                            pointHoverRadius: 5
                        }]
                    });
                    updateGeoMetrics(filteredData);
                    break;
                
                case 'tpu':
                    chartManager.updateChart('tpu', {
                        labels: filteredData.dates,
                        datasets: [{
                            label: 'TPU Indeks (% af artikler)',
                            data: filteredData.values,
                            borderColor: '#2A6965',
                            backgroundColor: 'rgba(42, 105, 101, 0.1)',
                            tension: 0.0,
                            fill: true,
                            pointRadius: 1,
                            pointHoverRadius: 5
                        }]
                    });
                    updateTpuMetrics(filteredData);
                    break;
            }
        }

        function updateExportChart(data) {
            const checkboxes = document.querySelectorAll('#exportDropdown input[type="checkbox"]:checked');
            const selectedCountries = Array.from(checkboxes).map(cb => cb.value);
            
            const colorMap = {
                'EU27': '#F5D547',
                'USA': '#005A8C',
                'Indien': '#FF9933',
                'Vietnam': '#DA251D',
                'Thailand': '#A51931',
                'Mexico': '#006847',
                'Rusland': '#0033A0',
                'Afrika': '#8B4513',
                'Ungarn': '#CE2939'
            };
            
            const datasets = [];
            selectedCountries.forEach(country => {
                if (data.countries[country]) {
                    datasets.push({
                        label: country,
                        data: data.countries[country],
                        borderColor: colorMap[country],
                        backgroundColor: `${colorMap[country]}20`,
                        tension: 0.0,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    });
                }
            });
            
            chartManager.updateChart('export', {
                labels: data.dates,
                datasets: datasets
            });
        }

        function updateExportMetrics(data) {
            // Update metrics for the main countries
            const metricsToUpdate = [
                { id: 'eu27Export', country: 'EU27', trendId: 'eu27Trend' },
                { id: 'usaExport', country: 'USA', trendId: 'usaExportTrend' },
                { id: 'indiaExport', country: 'Indien', trendId: 'indiaExportTrend' },
                { id: 'vietnamExport', country: 'Vietnam', trendId: 'vietnamTrend' },
                { id: 'thailandExport', country: 'Thailand', trendId: 'thailandTrend' },
                { id: 'mexicoExport', country: 'Mexico', trendId: 'mexicoTrend' }
            ];
            
            metricsToUpdate.forEach(metric => {
                const values = data.countries[metric.country];
                if (values && values.length > 0) {
                    const currentValue = values[values.length - 1] / 1e9; // Convert to billions
                    document.getElementById(metric.id).textContent = currentValue.toFixed(1) + ' mia.';
                    
                    if (values.length > 1) {
                        const previousValue = values[values.length - 2];
                        const change = ((values[values.length - 1] - previousValue) / previousValue * 100).toFixed(1);
                        const trendElement = document.getElementById(metric.trendId);
                        trendElement.textContent = (change > 0 ? '+' : '') + change + '%';
                        trendElement.className = change > 0 ? 'trend up' : 'trend down';
                    }
                }
            });
        }

        function updateTradeMetrics(data) {
            if (data && data.years.length > 0) {
                const currentYearIndex = data.years.length - 1;
                const prevYearIndex = currentYearIndex - 1;
                
                document.getElementById('worldTrade').textContent = 
                    data.World[currentYearIndex].toFixed(1) + '%';
                document.getElementById('euTrade').textContent = 
                    data.EU[currentYearIndex].toFixed(1) + '%';
                document.getElementById('chinaTrade').textContent = 
                    data.China[currentYearIndex].toFixed(1) + '%';
                document.getElementById('usaTrade').textContent = 
                    data.USA[currentYearIndex].toFixed(1) + '%';
                document.getElementById('indiaTrade').textContent = 
                    data.India[currentYearIndex].toFixed(1) + '%';
                document.getElementById('denmarkTrade').textContent = 
                    data.Denmark[currentYearIndex].toFixed(1) + '%';
                
                if (prevYearIndex >= 0) {
                    const worldChange = ((data.World[currentYearIndex] - data.World[prevYearIndex]) / 
                                        data.World[prevYearIndex] * 100).toFixed(1);
                    const euChange = ((data.EU[currentYearIndex] - data.EU[prevYearIndex]) / 
                                     data.EU[prevYearIndex] * 100).toFixed(1);
                    const chinaChange = ((data.China[currentYearIndex] - data.China[prevYearIndex]) / 
                                        data.China[prevYearIndex] * 100).toFixed(1);
                    const usaChange = ((data.USA[currentYearIndex] - data.USA[prevYearIndex]) / 
                                      data.USA[prevYearIndex] * 100).toFixed(1);
                    const indiaChange = ((data.India[currentYearIndex] - data.India[prevYearIndex]) / 
                                        data.India[prevYearIndex] * 100).toFixed(1);
                    const denmarkChange = ((data.Denmark[currentYearIndex] - data.Denmark[prevYearIndex]) / 
                                          data.Denmark[prevYearIndex] * 100).toFixed(1);
                    
                    document.getElementById('worldTradeTrend').textContent = (worldChange > 0 ? '+' : '') + worldChange + '%';
                    document.getElementById('euTradeTrend').textContent = (euChange > 0 ? '+' : '') + euChange + '%';
                    document.getElementById('chinaTradeTrend').textContent = (chinaChange > 0 ? '+' : '') + chinaChange + '%';
                    document.getElementById('usaTradeTrend').textContent = (usaChange > 0 ? '+' : '') + usaChange + '%';
                    document.getElementById('indiaTradeTrend').textContent = (indiaChange > 0 ? '+' : '') + indiaChange + '%';
                    document.getElementById('denmarkTradeTrend').textContent = (denmarkChange > 0 ? '+' : '') + denmarkChange + '%';
                    
                    document.getElementById('worldTradeTrend').className = worldChange > 0 ? 'trend up' : 'trend down';
                    document.getElementById('euTradeTrend').className = euChange > 0 ? 'trend up' : 'trend down';
                    document.getElementById('chinaTradeTrend').className = chinaChange > 0 ? 'trend up' : 'trend down';
                    document.getElementById('usaTradeTrend').className = usaChange > 0 ? 'trend up' : 'trend down';
                    document.getElementById('indiaTradeTrend').className = indiaChange > 0 ? 'trend up' : 'trend down';
                    document.getElementById('denmarkTradeTrend').className = denmarkChange > 0 ? 'trend up' : 'trend down';
                }
            }
        }

        function updateFdiMetrics(data) {
            const currentYear = data.years.length - 1;
            const prevYear = currentYear - 1;

            if (currentYear >= 0) {
                document.getElementById('usaFdi').textContent = 
                    data.USA[currentYear].toFixed(2) + '%';
                document.getElementById('chinaFdi').textContent = 
                    data.China[currentYear].toFixed(2) + '%';
                document.getElementById('euFdi').textContent = 
                    data.EU[currentYear].toFixed(2) + '%';

                if (prevYear >= 0) {
                    const usaTrend = ((data.USA[currentYear] - data.USA[prevYear]) / 
                                     data.USA[prevYear] * 100).toFixed(1);
                    const chinaTrend = ((data.China[currentYear] - data.China[prevYear]) / 
                                       data.China[prevYear] * 100).toFixed(1);
                    const euTrend = ((data.EU[currentYear] - data.EU[prevYear]) / 
                                    data.EU[prevYear] * 100).toFixed(1);

                    document.getElementById('usaTrend').textContent = (usaTrend > 0 ? '+' : '') + usaTrend + '%';
                    document.getElementById('chinaTrend').textContent = (chinaTrend > 0 ? '+' : '') + chinaTrend + '%';
                    document.getElementById('euTrend').textContent = (euTrend > 0 ? '+' : '') + euTrend + '%';

                    document.getElementById('usaTrend').className = usaTrend > 0 ? 'trend up' : 'trend down';
                    document.getElementById('chinaTrend').className = chinaTrend > 0 ? 'trend up' : 'trend down';
                    document.getElementById('euTrend').className = euTrend > 0 ? 'trend up' : 'trend down';
                }
            }
        }

        function updateRestrictionsMetrics(data) {
            const currentYearIndex = data.years.length - 1;
            const prevYearIndex = currentYearIndex - 1;

            if (currentYearIndex >= 0) {
                const currentTotal = data.G7[currentYearIndex] + data.BRICS[currentYearIndex];
                document.getElementById('totalRestrictions').textContent = currentTotal.toLocaleString();

                if (prevYearIndex >= 0) {
                    const prevTotal = data.G7[prevYearIndex] + data.BRICS[prevYearIndex];
                    const restrictionChange = currentTotal - prevTotal;
                    document.getElementById('restrictionsTrend').textContent = (restrictionChange > 0 ? '+' : '') + restrictionChange;
                    document.getElementById('restrictionsTrend').className = restrictionChange > 0 ? 'trend up' : 'trend down';
                }
            }
        }

        function updateGeoMetrics(data) {
            const values = data.values;
            if (values.length > 0) {
                const currentRisk = values[values.length - 1];
                document.getElementById('currentRisk').textContent = currentRisk.toFixed(1);

                if (values.length > 1) {
                    const previousRisk = values[values.length - 2];
                    const riskChange = ((currentRisk - previousRisk) / previousRisk * 100).toFixed(1);
                    document.getElementById('riskTrend').textContent = (riskChange > 0 ? '+' : '') + riskChange + '%';
                    document.getElementById('riskTrend').className = riskChange > 0 ? 'trend up' : 'trend down';
                }
            }
        }

        function updateTpuMetrics(data) {
            const values = data.values;
            if (values.length > 0) {
                const currentTPU = values[values.length - 1];
                document.getElementById('currentTPU').textContent = currentTPU.toFixed(2) + '%';

                if (values.length > 1) {
                    const previousTPU = values[values.length - 2];
                    const tpuChange = ((currentTPU - previousTPU) / previousTPU * 100).toFixed(1);
                    document.getElementById('tpuTrend').textContent = (tpuChange > 0 ? '+' : '') + tpuChange + '%';
                    document.getElementById('tpuTrend').className = tpuChange > 0 ? 'trend up' : 'trend down';
                }
            }
        }

        function updateAllMetrics(data) {
            // Update currency share (doesn't change with filter)
            document.getElementById('usdShare').textContent = 
                data.currencyData.current[0] + '%';
            
            // Update all other metrics
            updateTradeMetrics(data.tradeOpenness);
            updateFdiMetrics(data.fdiGdpData);
            updateRestrictionsMetrics(data.tradeRestrictions);
            updateGeoMetrics(data.geoRiskIndex);
            updateTpuMetrics(data.tpuIndex);
            updateExportMetrics(data.exportData);
        }

        // Initialize Dashboard
        async function initDashboard() {
            dataManager = new DataManager();
            chartManager = new ChartManager();

            const staticData = await dataManager.loadStaticData();
            if (!staticData) {
                document.getElementById('dataStatus').textContent = 'Failed to load data';
                return;
            }

            chartManager.initCharts(staticData);
            updateAllMetrics(staticData);

            // Setup dual range sliders
            setupDualRangeSlider('trade', 2000, 2024, 'trade');
            setupDualRangeSlider('export', 0, 77, 'export', true);
            setupDualRangeSlider('fdi', 2015, 2025, 'fdi');
            setupDualRangeSlider('restrictions', 2009, 2025, 'restrictions');
            setupDualRangeSlider('geo', 0, 67, 'geo', true);
            setupDualRangeSlider('tpu', 0, 67, 'tpu', true);

            // Setup country selector dropdowns
            setupCountrySelector();
            setupExportCountrySelector();

            // Try to fetch live data
            const liveSuccess = await dataManager.fetchLiveData();
            
            if (liveSuccess) {
                document.getElementById('dataStatus').textContent = 'Live data';
                document.getElementById('liveIndicator').style.display = 'inline-block';
            } else {
                document.getElementById('dataStatus').textContent = '';
            }
            
            document.getElementById('lastUpdate').textContent = 
                new Date().toLocaleTimeString('da-DK');

            // Set up periodic updates
            setInterval(async () => {
                const updated = await dataManager.fetchLiveData();
                if (updated) {
                    document.getElementById('lastUpdate').textContent = 
                        new Date().toLocaleTimeString('da-DK');
                }
            }, config.updateInterval);
        }

        // Country selector dropdown functionality
        function setupCountrySelector() {
            const dropdownBtn = document.getElementById('countryDropdownBtn');
            const dropdown = document.getElementById('countryDropdown');
            
            // Toggle dropdown on button click
            dropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
                // Update button text to show arrow direction
                if (dropdown.classList.contains('show')) {
                    dropdownBtn.innerHTML = 'V√¶lg lande ‚ñ≤';
                } else {
                    dropdownBtn.innerHTML = 'V√¶lg lande ‚ñº';
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                dropdown.classList.remove('show');
                dropdownBtn.innerHTML = 'V√¶lg lande ‚ñº';
            });
            
            // Prevent dropdown from closing when clicking inside it
            dropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Handle checkbox changes
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateTradeChartVisibility();
                });
            });
        }

        // Export country selector dropdown functionality
        function setupExportCountrySelector() {
            const dropdownBtn = document.getElementById('exportDropdownBtn');
            const dropdown = document.getElementById('exportDropdown');
            
            // Toggle dropdown on button click
            dropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
                // Update button text to show arrow direction
                if (dropdown.classList.contains('show')) {
                    dropdownBtn.innerHTML = 'V√¶lg lande ‚ñ≤';
                } else {
                    dropdownBtn.innerHTML = 'V√¶lg lande ‚ñº';
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                dropdown.classList.remove('show');
                dropdownBtn.innerHTML = 'V√¶lg lande ‚ñº';
            });
            
            // Prevent dropdown from closing when clicking inside it
            dropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Handle checkbox changes
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Update the export chart with current slider range
                    const minVal = parseInt(document.getElementById('exportMin').value);
                    const maxVal = parseInt(document.getElementById('exportMax').value);
                    updateChartByRange('export', minVal, maxVal);
                });
            });
        }

        // Update trade chart visibility based on selected countries
        function updateTradeChartVisibility() {
            const checkboxes = document.querySelectorAll('#countryDropdown input[type="checkbox"]');
            const selectedCountries = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedCountries.push(checkbox.value);
                }
            });
            
            // Update chart datasets visibility
            const chart = chartManager.charts.tradeOpenness;
            if (chart) {
                chart.data.datasets.forEach(dataset => {
                    let countryKey = dataset.label;
                    // Map Danish labels to data keys
                    if (countryKey === 'Verden') countryKey = 'World';
                    else if (countryKey === 'Danmark') countryKey = 'Denmark';
                    else if (countryKey === 'Kina') countryKey = 'China';
                    else if (countryKey === 'Indien') countryKey = 'India';
                    
                    dataset.hidden = !selectedCountries.includes(countryKey);
                });
                chart.update();
            }
            
            // Update metrics visibility
            updateMetricsVisibility(selectedCountries);
        }

        // Update metrics visibility based on selected countries
        function updateMetricsVisibility(selectedCountries) {
            const metricsMap = {
                'World': 'worldTrade',
                'EU': 'euTrade',
                'China': 'chinaTrade',
                'USA': 'usaTrade',
                'India': 'indiaTrade',
                'Denmark': 'denmarkTrade'
            };
            
            Object.keys(metricsMap).forEach(country => {
                const metricElement = document.getElementById(metricsMap[country]);
                if (metricElement && metricElement.parentElement) {
                    metricElement.parentElement.style.display = 
                        selectedCountries.includes(country) ? 'flex' : 'none';
                }
            });
            
            // Adjust grid columns based on visible metrics
            const visibleCount = selectedCountries.length;
            const metricsGrid = document.querySelector('.wide-metrics-grid');
            if (metricsGrid) {
                if (visibleCount <= 3) {
                    metricsGrid.style.gridTemplateColumns = `repeat(${visibleCount}, 1fr)`;
                } else {
                    metricsGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(140px, 1fr))';
                }
            }
        }

        // Start the dashboard
        window.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
