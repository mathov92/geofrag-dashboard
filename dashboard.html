<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geoeconomic Fragmentation Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .status-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px 20px;
            margin-bottom: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status { font-size: 0.9em; }
        .live-indicator {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); }
        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f7f7f7;
            border-radius: 8px;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        .trend {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .trend.up { background: #fef2f2; color: #dc2626; }
        .trend.down { background: #f0fdf4; color: #16a34a; }
        canvas { max-height: 300px; }
        #tradeMap { height: 400px; background: #f0f0f0; border-radius: 10px; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>üåç Geoeconomic Fragmentation Dashboard</h1>
        
        <div class="status-bar">
            <div class="status">
                <span id="dataStatus">Loading data...</span>
                <span class="live-indicator" id="liveIndicator" style="display:none;"></span>
            </div>
            <div class="status">Last update: <span id="lastUpdate">--</span></div>
        </div>

        <div class="grid">
            <!-- Trade Bloc Concentration -->
            <div class="card">
                <h2>Trade Bloc Concentration</h2>
                <canvas id="blocChart"></canvas>
                <div class="metric">
                    <span>Fragmentation Index</span>
                    <span class="metric-value" id="fragIndex">--</span>
                </div>
            </div>

            <!-- Currency Usage Trends -->
            <div class="card">
                <h2>Reserve Currency Shares</h2>
                <canvas id="currencyChart"></canvas>
                <div class="metric">
                    <span>USD Dominance</span>
                    <span class="metric-value" id="usdShare">--</span>
                </div>
            </div>

            <!-- Supply Chain Regionalization -->
            <div class="card">
                <h2>Supply Chain Regionalization</h2>
                <canvas id="supplyChart"></canvas>
                <div class="metric">
                    <span>Regional Trade %</span>
                    <span class="metric-value" id="regionalTrade">--</span>
                </div>
            </div>

            <!-- Tech Decoupling Index -->
            <div class="card">
                <h2>Technology Decoupling</h2>
                <canvas id="techChart"></canvas>
                <div class="metric">
                    <span>Decoupling Score</span>
                    <span class="metric-value" id="techScore">--</span>
                    <span class="trend up">+12%</span>
                </div>
            </div>
        </div>

        <!-- Trade Flow Map -->
        <div class="card">
            <h2>Global Trade Flow Fragmentation</h2>
            <div id="tradeMap">
                <div class="loading">Initializing map...</div>
            </div>
        </div>

        <!-- FDI Patterns -->
        <div class="grid">
            <div class="card">
                <h2>FDI Flow Patterns</h2>
                <canvas id="fdiChart"></canvas>
            </div>
            
            <div class="card">
                <h2>Sanctions & Trade Restrictions</h2>
                <canvas id="sanctionsChart"></canvas>
                <div class="metric">
                    <span>Active Measures</span>
                    <span class="metric-value" id="sanctionCount">--</span>
                    <span class="trend up">+45</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            staticDataPath: 'data/',
            githubRepo: 'username/geofrag-dashboard',
            updateInterval: 300000, // 5 minutes
            apis: {
                worldBank: 'https://api.worldbank.org/v2/',
                imf: 'https://www.imf.org/external/datamapper/api/v1/',
                fred: 'https://api.stlouisfed.org/fred/series/observations'
            }
        };

        // Data Manager
        class DataManager {
            constructor() {
                this.cache = {};
                this.lastUpdate = null;
            }

            async loadStaticData() {
                try {
                    // In production, these would be actual JSON files in your repo
                    // For demo, using simulated data
                    return {
                        blocData: {
                            labels: ['USMCA', 'EU', 'ASEAN', 'RCEP', 'Mercosur', 'Other'],
                            values: [24, 21, 12, 28, 5, 10],
                            historical: [
                                [22, 23, 24, 24, 25, 24],
                                [20, 21, 21, 22, 21, 21],
                                [10, 11, 11, 12, 12, 12]
                            ]
                        },
                        currencyData: {
                            labels: ['USD', 'EUR', 'CNY', 'JPY', 'GBP', 'Other'],
                            current: [59.2, 20.1, 12.3, 5.2, 4.9, 8.3],
                            historical: {
                                2020: [60.5, 20.8, 10.9, 5.8, 4.4, 7.6],
                                2021: [59.8, 20.6, 11.2, 5.5, 4.7, 8.2],
                                2022: [59.5, 20.3, 11.8, 5.3, 4.8, 8.3],
                                2023: [59.3, 20.2, 12.0, 5.2, 4.9, 8.4],
                                2024: [59.2, 20.1, 12.3, 5.2, 4.9, 8.3]
                            }
                        },
                        supplyChainData: {
                            regional: [45, 48, 52, 55, 58, 61],
                            global: [55, 52, 48, 45, 42, 39],
                            years: [2019, 2020, 2021, 2022, 2023, 2024]
                        },
                        techDecoupling: {
                            semiconductors: 72,
                            telecom: 68,
                            ai: 61,
                            quantum: 83,
                            biotech: 45
                        },
                        fdiFlows: {
                            intraBloc: [320, 340, 310, 380, 420],
                            interBloc: [480, 450, 420, 380, 350],
                            years: [2020, 2021, 2022, 2023, 2024]
                        },
                        sanctions: {
                            count: 3247,
                            byYear: [1250, 1680, 2340, 2890, 3247],
                            years: [2020, 2021, 2022, 2023, 2024]
                        }
                    };
                } catch (error) {
                    console.error('Failed to load static data:', error);
                    return null;
                }
            }

            async fetchLiveData() {
                // Attempt to fetch live data, fallback to cache
                try {
                    // Example: Try World Bank API (often CORS-friendly)
                    const response = await fetch(`https://api.worldbank.org/v2/country/all/indicator/NY.GDP.MKTP.CD?format=json&date=2023`);
                    if (response.ok) {
                        const data = await response.json();
                        this.cache.liveGDP = data;
                        this.lastUpdate = new Date();
                        return true;
                    }
                } catch (error) {
                    console.log('Live data fetch failed, using cache');
                }
                return false;
            }

            calculateFragmentationIndex(data) {
                // Simple fragmentation metric based on trade concentration
                const herfindahl = data.blocData.values.reduce((sum, val) => 
                    sum + Math.pow(val/100, 2), 0);
                return (1 - herfindahl).toFixed(3);
            }
        }

        // Chart Manager
        class ChartManager {
            constructor() {
                this.charts = {};
            }

            initCharts(data) {
                // Trade Bloc Chart
                this.charts.bloc = new Chart(document.getElementById('blocChart'), {
                    type: 'doughnut',
                    data: {
                        labels: data.blocData.labels,
                        datasets: [{
                            data: data.blocData.values,
                            backgroundColor: [
                                '#667eea', '#764ba2', '#f093fb', 
                                '#4facfe', '#43e97b', '#fa709a'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                // Currency Chart
                this.charts.currency = new Chart(document.getElementById('currencyChart'), {
                    type: 'bar',
                    data: {
                        labels: data.currencyData.labels,
                        datasets: [{
                            label: 'Share %',
                            data: data.currencyData.current,
                            backgroundColor: '#667eea'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 70 }
                        }
                    }
                });

                // Supply Chain Chart
                this.charts.supply = new Chart(document.getElementById('supplyChart'), {
                    type: 'line',
                    data: {
                        labels: data.supplyChainData.years,
                        datasets: [{
                            label: 'Regional',
                            data: data.supplyChainData.regional,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Global',
                            data: data.supplyChainData.global,
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                // Tech Decoupling Chart
                this.charts.tech = new Chart(document.getElementById('techChart'), {
                    type: 'radar',
                    data: {
                        labels: Object.keys(data.techDecoupling),
                        datasets: [{
                            label: 'Decoupling Score',
                            data: Object.values(data.techDecoupling),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });

                // FDI Chart
                this.charts.fdi = new Chart(document.getElementById('fdiChart'), {
                    type: 'bar',
                    data: {
                        labels: data.fdiFlows.years,
                        datasets: [{
                            label: 'Intra-bloc',
                            data: data.fdiFlows.intraBloc,
                            backgroundColor: '#667eea'
                        }, {
                            label: 'Inter-bloc',
                            data: data.fdiFlows.interBloc,
                            backgroundColor: '#764ba2'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true }
                        }
                    }
                });

                // Sanctions Chart
                this.charts.sanctions = new Chart(document.getElementById('sanctionsChart'), {
                    type: 'line',
                    data: {
                        labels: data.sanctions.years,
                        datasets: [{
                            label: 'Active Measures',
                            data: data.sanctions.byYear,
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            updateChart(chartName, newData) {
                if (this.charts[chartName]) {
                    this.charts[chartName].data = newData;
                    this.charts[chartName].update();
                }
            }
        }

        // Initialize Dashboard
        async function initDashboard() {
            const dataManager = new DataManager();
            const chartManager = new ChartManager();

            // Load static baseline data
            const staticData = await dataManager.loadStaticData();
            if (!staticData) {
                document.getElementById('dataStatus').textContent = 'Failed to load data';
                return;
            }

            // Initialize charts with static data
            chartManager.initCharts(staticData);

            // Update metrics
            document.getElementById('fragIndex').textContent = 
                dataManager.calculateFragmentationIndex(staticData);
            document.getElementById('usdShare').textContent = 
                staticData.currencyData.current[0] + '%';
            document.getElementById('regionalTrade').textContent = 
                staticData.supplyChainData.regional[staticData.supplyChainData.regional.length - 1] + '%';
            document.getElementById('techScore').textContent = 
                Math.round(Object.values(staticData.techDecoupling).reduce((a,b) => a+b) / 5);
            document.getElementById('sanctionCount').textContent = 
                staticData.sanctions.count.toLocaleString();

            // Try to fetch live data
            const liveSuccess = await dataManager.fetchLiveData();
            
            // Update status
            if (liveSuccess) {
                document.getElementById('dataStatus').textContent = 'Live data';
                document.getElementById('liveIndicator').style.display = 'inline-block';
            } else {
                document.getElementById('dataStatus').textContent = 'Using cached data';
            }
            
            document.getElementById('lastUpdate').textContent = 
                new Date().toLocaleTimeString();

            // Initialize map visualization
            initTradeMap();

            // Set up periodic updates
            setInterval(async () => {
                const updated = await dataManager.fetchLiveData();
                if (updated) {
                    document.getElementById('lastUpdate').textContent = 
                        new Date().toLocaleTimeString();
                }
            }, config.updateInterval);
        }

        // Simple trade flow visualization
        function initTradeMap() {
            const width = document.getElementById('tradeMap').offsetWidth;
            const height = 400;

            const svg = d3.select('#tradeMap')
                .html('')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Sample bloc positions
            const blocs = [
                {name: 'USMCA', x: width * 0.2, y: height * 0.3, size: 24},
                {name: 'EU', x: width * 0.5, y: height * 0.2, size: 21},
                {name: 'RCEP', x: width * 0.8, y: height * 0.4, size: 28},
                {name: 'ASEAN', x: width * 0.7, y: height * 0.6, size: 12},
                {name: 'Mercosur', x: width * 0.3, y: height * 0.7, size: 5}
            ];

            // Draw connections (trade flows)
            const connections = [
                [0, 1, 0.8], [0, 2, 0.4], [1, 2, 0.3],
                [2, 3, 0.9], [0, 4, 0.6], [1, 3, 0.5]
            ];

            connections.forEach(([source, target, strength]) => {
                svg.append('line')
                    .attr('x1', blocs[source].x)
                    .attr('y1', blocs[source].y)
                    .attr('x2', blocs[target].x)
                    .attr('y2', blocs[target].y)
                    .attr('stroke', '#667eea')
                    .attr('stroke-width', strength * 3)
                    .attr('opacity', 0.3);
            });

            // Draw bloc nodes
            const nodes = svg.selectAll('g')
                .data(blocs)
                .enter()
                .append('g');

            nodes.append('circle')
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('r', d => Math.sqrt(d.size) * 5)
                .attr('fill', '#667eea')
                .attr('opacity', 0.8);

            nodes.append('text')
                .attr('x', d => d.x)
                .attr('y', d => d.y + 5)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .attr('font-weight', 'bold')
                .attr('font-size', '12px')
                .text(d => d.name);
        }

        // Start the dashboard
        window.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
